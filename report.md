# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Weak Randomness](#h-1-weak-randomness)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: Missing checks for `address(0)` when assigning values to address state variables](#l-2-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [L-3: Define and use `constant` variables instead of using literals](#l-3-define-and-use-constant-variables-instead-of-using-literals)
  - [L-4: Event is missing `indexed` fields](#l-4-event-is-missing-indexed-fields)
  - [L-5: Modifiers invoked only once can be shoe-horned into the function](#l-5-modifiers-invoked-only-once-can-be-shoe-horned-into-the-function)
  - [L-6: Large literal values multiples of 10000 can be replaced with scientific notation](#l-6-large-literal-values-multiples-of-10000-can-be-replaced-with-scientific-notation)
  - [L-7: Contract still has TODOs](#l-7-contract-still-has-todos)
  - [L-8: State variable changes but no event is emitted.](#l-8-state-variable-changes-but-no-event-is-emitted)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 7 |
| Total nSLOC | 668 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/EmergencyMultiSig.sol | 101 |
| src/LPToken.sol | 12 |
| src/interfaces/IMultiSigExecutor.sol | 4 |
| src/interfaces/ISimpleAmm.sol | 36 |
| src/storage/EternalStorage.sol | 89 |
| src/storage/EternalStorageAccessLibrary.sol | 87 |
| src/v2/SimpleAMMV2.sol | 339 |
| **Total** | **668** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 1 |
| Low | 8 |


# High Issues

## H-1: Weak Randomness

The use of keccak256 hash functions on predictable values like block.timestamp, block.number, or similar data, including modulo operations on these values, should be avoided for generating randomness, as they are easily predictable and manipulable. The `PREVRANDAO` opcode also should not be used as a source of randomness. Instead, utilize Chainlink VRF for cryptographically secure and provably random values to ensure protocol integrity.

<details><summary>1 Found Instances</summary>


- Found in src/EmergencyMultiSig.sol [Line: 78](src/EmergencyMultiSig.sol#L78)

	```solidity
	        bytes32 proposalId = keccak256(abi.encode(token, to, amount, block.timestamp));
	```

</details>



# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>15 Found Instances</summary>


- Found in src/EmergencyMultiSig.sol [Line: 8](src/EmergencyMultiSig.sol#L8)

	```solidity
	contract EmergencyMultiSig is AccessControl, ReentrancyGuard {
	```

- Found in src/EmergencyMultiSig.sol [Line: 64](src/EmergencyMultiSig.sol#L64)

	```solidity
	    function setExecutor(address _executor) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/EmergencyMultiSig.sol [Line: 72](src/EmergencyMultiSig.sol#L72)

	```solidity
	        onlyRole(SIGNER_ROLE)
	```

- Found in src/EmergencyMultiSig.sol [Line: 96](src/EmergencyMultiSig.sol#L96)

	```solidity
	    function approveWithdrawal(bytes32 proposalId) external onlyRole(SIGNER_ROLE) {
	```

- Found in src/EmergencyMultiSig.sol [Line: 111](src/EmergencyMultiSig.sol#L111)

	```solidity
	    function executeWithdrawal(bytes32 proposalId) external nonReentrant onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/LPToken.sol [Line: 7](src/LPToken.sol#L7)

	```solidity
	contract LPToken is ERC20, Ownable {
	```

- Found in src/LPToken.sol [Line: 10](src/LPToken.sol#L10)

	```solidity
	    function mint(address to, uint256 amount) external onlyOwner {
	```

- Found in src/LPToken.sol [Line: 14](src/LPToken.sol#L14)

	```solidity
	    function burn(address from, uint256 amount) external onlyOwner {
	```

- Found in src/storage/EternalStorage.sol [Line: 11](src/storage/EternalStorage.sol#L11)

	```solidity
	contract EternalStorage is AccessControl, Pausable {
	```

- Found in src/storage/EternalStorage.sol [Line: 47](src/storage/EternalStorage.sol#L47)

	```solidity
	        onlyRole(DEFAULT_ADMIN_ROLE)
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 18](src/v2/SimpleAMMV2.sol#L18)

	```solidity
	contract SimpleAMMV2 is ISimpleAMM, IMultiSigExecutor, ReentrancyGuard, AccessControl, Pausable {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 139](src/v2/SimpleAMMV2.sol#L139)

	```solidity
	    function initialize(address _emergencyMultiSig) external initializer onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 149](src/v2/SimpleAMMV2.sol#L149)

	```solidity
	    function pause() external onlyRole(EMERGENCY_ROLE) {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 154](src/v2/SimpleAMMV2.sol#L154)

	```solidity
	    function unpause() external onlyRole(EMERGENCY_ROLE) {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 159](src/v2/SimpleAMMV2.sol#L159)

	```solidity
	    function setFee(uint256 newFee) external onlyRole(OPERATOR_ROLE) {
	```

</details>



## L-2: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

<details><summary>1 Found Instances</summary>


- Found in src/storage/EternalStorage.sol [Line: 51](src/storage/EternalStorage.sol#L51)

	```solidity
	        logicContract = _logicContract;
	```

</details>



## L-3: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>2 Found Instances</summary>


- Found in src/v2/SimpleAMMV2.sol [Line: 434](src/v2/SimpleAMMV2.sol#L434)

	```solidity
	        if (amountIn > reserveIn * MAX_TRADE_SIZE_BPS / 10000) {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 435](src/v2/SimpleAMMV2.sol#L435)

	```solidity
	            revert SimpleAMM__SwapAmountTooHigh(amountIn, reserveIn * MAX_TRADE_SIZE_BPS / 10000);
	```

</details>



## L-4: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details><summary>5 Found Instances</summary>


- Found in src/EmergencyMultiSig.sol [Line: 23](src/EmergencyMultiSig.sol#L23)

	```solidity
	    event WithdrawalProposed(bytes32 indexed proposalId, address indexed token, address to, uint256 amount, uint256 deadline);
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 50](src/v2/SimpleAMMV2.sol#L50)

	```solidity
	    event LiquidityAdded(
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 53](src/v2/SimpleAMMV2.sol#L53)

	```solidity
	    event LiquidityRemoved(
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 56](src/v2/SimpleAMMV2.sol#L56)

	```solidity
	    event TokenSwap(address indexed token, uint256 tokenAmount, uint256 ethAmount);
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 57](src/v2/SimpleAMMV2.sol#L57)

	```solidity
	    event FeeUpdated(uint256 oldFee, uint256 newFee);
	```

</details>



## L-5: Modifiers invoked only once can be shoe-horned into the function



<details><summary>1 Found Instances</summary>


- Found in src/v2/SimpleAMMV2.sol [Line: 102](src/v2/SimpleAMMV2.sol#L102)

	```solidity
	    modifier initializer() {
	```

</details>



## L-6: Large literal values multiples of 10000 can be replaced with scientific notation

Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>5 Found Instances</summary>


- Found in src/v2/SimpleAMMV2.sol [Line: 77](src/v2/SimpleAMMV2.sol#L77)

	```solidity
	    uint256 public constant MINIMUM_LIQUIDITY = 1_000_000;
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 78](src/v2/SimpleAMMV2.sol#L78)

	```solidity
	    uint256 public constant FEE_DENOMINATOR = 10000;
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 81](src/v2/SimpleAMMV2.sol#L81)

	```solidity
	    uint256 public constant PRICE_IMPACT_DENOMINATOR = 10000;
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 434](src/v2/SimpleAMMV2.sol#L434)

	```solidity
	        if (amountIn > reserveIn * MAX_TRADE_SIZE_BPS / 10000) {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 435](src/v2/SimpleAMMV2.sol#L435)

	```solidity
	            revert SimpleAMM__SwapAmountTooHigh(amountIn, reserveIn * MAX_TRADE_SIZE_BPS / 10000);
	```

</details>



## L-7: Contract still has TODOs

Contract contains comments with TODOS

<details><summary>1 Found Instances</summary>


- Found in src/EmergencyMultiSig.sol [Line: 8](src/EmergencyMultiSig.sol#L8)

	```solidity
	contract EmergencyMultiSig is AccessControl, ReentrancyGuard {
	```

</details>



## L-8: State variable changes but no event is emitted.

State variable changes in this function but no event is emitted.

<details><summary>14 Found Instances</summary>


- Found in src/EmergencyMultiSig.sol [Line: 64](src/EmergencyMultiSig.sol#L64)

	```solidity
	    function setExecutor(address _executor) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/storage/EternalStorage.sol [Line: 56](src/storage/EternalStorage.sol#L56)

	```solidity
	    function setUint(bytes32 key, uint256 value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 64](src/storage/EternalStorage.sol#L64)

	```solidity
	    function deleteUint(bytes32 key) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 68](src/storage/EternalStorage.sol#L68)

	```solidity
	    function setAddress(bytes32 key, address value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 76](src/storage/EternalStorage.sol#L76)

	```solidity
	    function deleteAddress(bytes32 key) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 80](src/storage/EternalStorage.sol#L80)

	```solidity
	    function setBool(bytes32 key, bool value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 88](src/storage/EternalStorage.sol#L88)

	```solidity
	    function deleteBool(bytes32 key) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 92](src/storage/EternalStorage.sol#L92)

	```solidity
	    function setBytes(bytes32 key, bytes calldata value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 100](src/storage/EternalStorage.sol#L100)

	```solidity
	    function deleteBytes(bytes32 key) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 104](src/storage/EternalStorage.sol#L104)

	```solidity
	    function setInt(bytes32 key, int256 value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 112](src/storage/EternalStorage.sol#L112)

	```solidity
	    function deleteInt(bytes32 key) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 116](src/storage/EternalStorage.sol#L116)

	```solidity
	    function setString(bytes32 key, string calldata value) external onlyLogic {
	```

- Found in src/storage/EternalStorage.sol [Line: 124](src/storage/EternalStorage.sol#L124)

	```solidity
	    function deleteString(bytes32 key) external onlyLogic {
	```

- Found in src/v2/SimpleAMMV2.sol [Line: 139](src/v2/SimpleAMMV2.sol#L139)

	```solidity
	    function initialize(address _emergencyMultiSig) external initializer onlyRole(DEFAULT_ADMIN_ROLE) {
	```

</details>



